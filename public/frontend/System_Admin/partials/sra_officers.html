<script>
  // Ensure modal close/cancel buttons use the global closeAddSRA after dynamic load
  document.addEventListener("DOMContentLoaded", function () {
    function attachSRAOfficerModalHandlers() {
      var closeBtn = document.querySelector(
        "#addSraModal .absolute.top-3.right-4"
      );
      var cancelBtn = document.querySelector(
        '#addSraModal button[type="button"]'
      );
      if (closeBtn) closeBtn.onclick = window.closeAddSRA;
      if (cancelBtn) cancelBtn.onclick = window.closeAddSRA;
    }
    // Try immediately, then again after a short delay for dynamic loads
    attachSRAOfficerModalHandlers();
    setTimeout(attachSRAOfficerModalHandlers, 500);
  });
</script>
<div class="bg-white rounded-2xl card-shadow p-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <div>
      <h2 class="text-2xl font-extrabold text-gray-900 tracking-tight">
        SRA Officers Management
      </h2>
      <p class="text-gray-600 text-sm">Manage SRA officers</p>
    </div>
    <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
      <button
        onclick="refreshSRAOfficers()"
        class="w-full sm:w-auto inline-flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 active:scale-[.99] transition-all shadow-sm"
      >
        <i class="fas fa-sync-alt"></i>
        <span>Refresh</span>
      </button>
      <button
        onclick="window.openAddSRA()"
        class="w-full sm:w-auto inline-flex items-center justify-center gap-2 bg-[var(--cane-600)] text-white px-4 py-2 rounded-lg hover:bg-[var(--cane-700)] active:scale-[.99] transition-all shadow-sm"
      >
        <i class="fas fa-plus"></i>
        <span>Add SRA Officer</span>
      </button>
    </div>
  </div>

  <div class="overflow-hidden border border-gray-200 rounded-xl">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Officer Details
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Account Status
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody id="sraTableBody" class="bg-white divide-y divide-gray-200">
          <tr>
            <td colspan="3" class="px-6 py-10">
              <div
                class="flex flex-col items-center justify-center text-center text-gray-500"
              >
                <i class="fas fa-user-tie text-2xl mb-2 text-gray-400"></i>
                <p>Loading SRA officers...</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Table footer: show entries and summary -->
  <div class="flex items-center justify-between flex-wrap gap-3 mt-4 text-sm">
    <div class="flex items-center gap-2">
      <label for="sraPageSize" class="text-gray-600">Show</label>
      <select
        id="sraPageSize"
        class="border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-[var(--cane-500)]"
      >
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
      </select>
      <span class="text-gray-600">entries</span>
    </div>
    <div class="text-gray-600">
      Showing <span id="sraShowingStart">0</span> to
      <span id="sraShowingEnd">0</span> of <span id="sraTotal">0</span> entries
    </div>
  </div>
</div>

<!-- Create Admin Officer Account Modal -->
<div
  id="addSraModal"
  class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-2xl w-[92%] max-w-xl p-6 shadow-2xl relative">
    <button id="sraModalCloseBtn" class="absolute top-3 right-4 text-xl">
      Ã—
    </button>
    <h3 class="text-xl font-bold text-gray-900 mb-4">
      Create Admin Officer Account
    </h3>
    <form id="addSRAForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
        <input
          id="sraName"
          type="text"
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cane-500)]"
          placeholder="Full name"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Email</label
        >
        <input
          id="sraEmail"
          type="email"
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cane-500)]"
          placeholder="name@example.com"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
        <select
          title="SRA Officer"
          id="sraRole"
          class="w-full px-4 py-2 border rounded-lg bg-gray-50"
          disabled
        >
          <option value="sra">SRA Officer</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Temporary Password</label
        >
        <div class="flex gap-2">
          <input
            id="sraTempPassword"
            type="text"
            required
            class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cane-500)]"
            placeholder="Auto-generated"
          />
          <button
            type="button"
            id="genTempPass"
            class="px-3 py-2 rounded-lg bg-[var(--cane-600)] text-white hover:bg-[var(--cane-700)]"
          >
            Auto-generate <span class="ml-1">ðŸ”„</span>
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-1">
          Share this one-time password with the officer.
        </p>
      </div>
      <!-- Status is auto-managed by email verification system (verified/pending) -->
      <div class="pt-1">
        <label class="inline-flex items-start gap-2">
          <input id="requireChange" type="checkbox" class="mt-1" checked />
          <span class="text-sm text-gray-700"
            >On first login, SRA Officer is forced to change password.</span
          >
        </label>
      </div>
      <div class="flex justify-end gap-3 pt-2">
        <button
          id="sraModalCancelBtn"
          type="button"
          class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-5 py-2 rounded-lg bg-[var(--cane-600)] hover:bg-[var(--cane-700)] text-white"
        >
          Create Officer
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Local close function for SRA modal
  function closeAddSRA() {
    var m = document.getElementById("addSraModal");
    if (m) {
      m.classList.add("hidden");
      m.classList.remove("flex");
    }
  }
  document.addEventListener("DOMContentLoaded", function () {
    var closeBtn = document.getElementById("sraModalCloseBtn");
    var cancelBtn = document.getElementById("sraModalCancelBtn");
    if (closeBtn) closeBtn.addEventListener("click", closeAddSRA);
    if (cancelBtn) cancelBtn.addEventListener("click", closeAddSRA);
  });
</script>
